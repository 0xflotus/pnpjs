<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>@pnp - SharePoint Patterns and Practices JavaScript Libraries</title>
    <link rel="stylesheet" href="/pnp/css/highlightjs-github.css">
    <link rel="stylesheet" href="/pnp/css/site.css">
</head>

<body>
    <header>
        <span id="headerText">
            <a href="/pnp">SharePoint Patterns and Practices</a>
        </span>
        <span id="subheaderText">Client Side Libraries</span>
    </header>

    <nav id="breadcrumbs">
        <a href="/pnp">@pnp</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/pnp/odata">odata</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/pnp/odata/caching.html">caching</a>
    </nav>

    <article>
        <h1>@pnp/odata/caching</h1>
<p>Often times data doesn’t change that quickly, especially in the case of rolling up corporate news or upcoming events. These types of things can be cached for minutes if not hours. To help make caching easy you just need to insert the usingCaching method in your chain. This only applies to get requests. The usingCaching method can be used with the inBatch method as well to cache the results of batched requests.</p>
<p>The below examples uses the @pnp/sp library as the example - but this works equally well for any library making use of the @pnp/odata base classes, such as @pnp/graph.</p>
<h2>Basic example</h2>
<p>You can use the method without any additional configuration. We have made some default choices for you and will discuss ways to override them later. The below code will get the items from the list, first checking the cache for the value. You can also use it with OData operators such as top and orderBy. The usingCaching() should always be the last method in the chain before the get() (OR if you are using [[batching]] these methods can be transposed, more details below).</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { sp } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

sp.web.lists.getByTitle(<span class="hljs-string">"Tasks"</span>).items.usingCaching().get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});

sp.web.lists.getByTitle(<span class="hljs-string">"Tasks"</span>).items.top(<span class="hljs-number">5</span>).orderBy(<span class="hljs-string">"Modified"</span>).usingCaching().get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});
</code></pre>
<h2>Globally Configure Cache Settings</h2>
<p>If you would like to not use the default values, but don’t want to clutter your code by setting the caching values on each request you can configure custom options globally. These will be applied to all calls to usingCaching() throughout your application.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { sp } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

sp.setup({
    defaultCachingStore: <span class="hljs-string">"session"</span>, <span class="hljs-comment">// or "local"</span>
    defaultCachingTimeoutSeconds: <span class="hljs-number">30</span>,
    globalCacheDisable: <span class="hljs-literal">false</span> <span class="hljs-comment">// or true to disable caching in case of debugging/testing</span>
});

sp.web.lists.getByTitle(<span class="hljs-string">"Tasks"</span>).items.top(<span class="hljs-number">5</span>).orderBy(<span class="hljs-string">"Modified"</span>).usingCaching().get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});
</code></pre>
<h2>Per Call Configuration</h2>
<p>If you prefer more verbose code or have a need to manage the cache settings on a per request basis you can include individual caching settings for each request. These settings are passed to the usingCaching method call and are defined in the following interface. If you want to use the per-request options you must include the key.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ICachingOptions {
    expiration?: <span class="hljs-built_in">Date</span>;
    storeName?: <span class="hljs-string">"session"</span> | <span class="hljs-string">"local"</span>;
    key: <span class="hljs-built_in">string</span>;
}
</code></pre>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { sp } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;
<span class="hljs-keyword">import</span> { Util } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/common"</span>;

sp.web.lists.getByTitle(<span class="hljs-string">"Tasks"</span>).items.top(<span class="hljs-number">5</span>).orderBy(<span class="hljs-string">"Modified"</span>).usingCaching({
    expiration: Util.dateAdd(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(), <span class="hljs-string">"minute"</span>, <span class="hljs-number">20</span>),
    key: <span class="hljs-string">"My Key"</span>,
    storeName: <span class="hljs-string">"local"</span>
}).get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});
</code></pre>
<h2>Using <a href="batching.html">Batching</a> with Caching</h2>
<p>You can use batching and caching together, but remember caching is only applied to get requests. When you use them together the methods can be transposed, the below example is valid.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { sp } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">let</span> batch = sp.createBatch();

sp.web.lists.inBatch(batch).usingCaching().get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});

sp.web.lists.getByTitle(<span class="hljs-string">"Tasks"</span>).items.usingCaching().inBatch(batch).get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(r)
});

batch.execute().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"All done!"</span>));
</code></pre>

    </article>

    <footer>
        &copy; Microsoft 2018
        <br /> Please
        <a href="https://github.com/pnp/pnp/issues/new?title=Documentation: odata\caching.html&body=Please describe how we can improve the doc page:">report documentation issues/suggestions</a> to help us improve!
    </footer>
</body>

</html><img src="https://telemetry.sharepointpnp.com/@pnp/pnp/ghpages/odata/docs/caching" alt="spacer" />