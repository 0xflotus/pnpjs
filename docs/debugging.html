<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>@pnp - SharePoint Patterns and Practices JavaScript Libraries</title>
    <link rel="stylesheet" href="/pnpjs/css/highlightjs-github.css">
    <link rel="stylesheet" href="/pnpjs/css/site.css">
</head>

<body>
    <header>
        <div class="right">
            <form method="get" action="http://www.bing.com/search">
                <input type="text" name="q" size="25" maxlength="255" value="" placeholder="Search this site..." />
                <input type="hidden" name="q1" value="site:https://pnp.github.io/pnpjs/" />
                <input type="submit" value="Search" />
            </form>
        </div>
        <div class="logo">
            <img src="/pnpjs/img/office365-header-icon.png" alt="Logo" />
        </div>
        <div class="pnp-title">
            <span id="headerText">
                <a href="/pnpjs">SharePoint Patterns and Practices</a>
            </span>
            <span id="subheaderText">PnPjs: Client Side Libraries for Microsoft 365</span>
        </div>
    </header>

    <nav id="breadcrumbs">
        <a href="/pnpjs">@pnp</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/pnpjs/debugging.html">debugging</a>
    </nav>

    <article>
        <h1 id="debugging">Debugging <a class="permalink" href="#debugging" aria-hidden="true">#</a></h1>
<h2 id="debugging-library-features-in-code-using-node">Debugging Library Features in Code using Node <a class="permalink" href="#debugging-library-features-in-code-using-node" aria-hidden="true">#</a></h2>
<p>The easiest way to debug the library when working on new features is using F5 in Visual Studio Code. This uses the <a href="../blob/master/.vscode/launch.json">launch.json</a> file to build and run the library using ./debug/launch/main.ts as the program entry. You can add any number of files to this directory and they will be ignored by git, however the debug.ts file is not, so please ensure you don’t commit any login information.</p>
<h3 id="setup-settings.js">Setup settings.js <a class="permalink" href="#setup-settings.js" aria-hidden="true">#</a></h3>
<p>If you have not already you need to create a settings.js files by copying settings.example.js and renaming it to settings.js. Then update the clientId, clientSecret, and siteUrl fields in the testing section. (See below for guidance on registering a client id and secret)</p>
<h3 id="test-your-setup">Test your setup <a class="permalink" href="#test-your-setup" aria-hidden="true">#</a></h3>
<p>If you hit F5 now you should be able to see the full response from getting the web’s title in the internal console window. If not, ensure that you have properly updated the settings file and registered the add-in perms correctly.</p>
<h3 id="create-a-debug-module">Create a debug module <a class="permalink" href="#create-a-debug-module" aria-hidden="true">#</a></h3>
<p>Using ./debug/launch/example.ts as a reference create a debugging file in the debug folder, let’s call it mydebug.ts and add this content:</p>
<pre><code class="language-TypeScript"><span class="hljs-comment">// note we can use the actual package names for our imports</span>
<span class="hljs-keyword">import</span> { sp, ListEnsureResult } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;
<span class="hljs-keyword">import</span> { Logger, LogLevel, ConsoleListener } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/logging"</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-keyword">var</span> process: { exit(code?: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> };

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyDebug</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// run some debugging</span>
    sp.web.lists.ensure(<span class="hljs-string">"MyFirstList"</span>).then(<span class="hljs-function">(<span class="hljs-params">list: ListEnsureResult</span>) =&gt;</span> {

        Logger.log({
            data: list.created,
            message: <span class="hljs-string">"Was list created?"</span>,
            level: LogLevel.Verbose
        });

        <span class="hljs-keyword">if</span> (list.created) {

            Logger.log({
                data: list.data,
                message: <span class="hljs-string">"Raw data from list creation."</span>,
                level: LogLevel.Verbose
            });

        } <span class="hljs-keyword">else</span> {

            Logger.log({
                data: <span class="hljs-literal">null</span>,
                message: <span class="hljs-string">"List already existed!"</span>,
                level: LogLevel.Verbose
            });
        }

        process.exit(<span class="hljs-number">0</span>);
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {

        Logger.error(e);
        process.exit(<span class="hljs-number">1</span>);
    });
}
</code></pre>
<h3 id="update-main.ts-to-launch-your-module">Update main.ts to launch your module <a class="permalink" href="#update-main.ts-to-launch-your-module" aria-hidden="true">#</a></h3>
<p>First comment out the import for the default example and then add the import and function call for yours, the updated main.ts should look like this:</p>
<pre><code class="language-TypeScript"><span class="hljs-comment">// ...</span>

<span class="hljs-comment">// comment out the example</span>
<span class="hljs-comment">// import { Example } from "./example";</span>
<span class="hljs-comment">// Example();</span>

<span class="hljs-keyword">import</span> { MyDebug } <span class="hljs-keyword">from</span> <span class="hljs-string">"./mydebug"</span>
MyDebug();

<span class="hljs-comment">// ...</span>
</code></pre>
<h3 id="debug!">Debug! <a class="permalink" href="#debug!" aria-hidden="true">#</a></h3>
<p>Place a break point within the promise resolution in your debug file and hit F5. Your module should be run and your break point hit. You can then examine the contents of the objects and see the run time state. Remember you can also set breakpoints within the package src folders to see exactly how things are working during your debugging scenarios.</p>
<h3 id="next-steps">Next Steps <a class="permalink" href="#next-steps" aria-hidden="true">#</a></h3>
<p>Using this pattern you can create and preserve multiple debugging scenarios in separate modules locally.</p>
<h2 id="in-browser-debugging">In Browser Debugging <a class="permalink" href="#in-browser-debugging" aria-hidden="true">#</a></h2>
<p>You can also serve files locally to debug in a browser through two methods. The first will serve code using ./debug/serve/main.ts as the entry. Meaning you can easily
write code and test it in the browser. The second method allows you to serve a single package (bundled with all dependencies) for in browser testing. Both methods serve
the file from <a href="https://localhost:8080/assets/pnp.js">https://localhost:8080/assets/pnp.js</a>, allowing you to create a single page in your tenant for in browser testing.</p>
<h3 id="start-the-local-serve">Start the local serve <a class="permalink" href="#start-the-local-serve" aria-hidden="true">#</a></h3>
<p>This will serve a package with ./debug/serve/main.ts as the entry.</p>
<p><code>gulp serve</code></p>
<h3 id="add-reference-to-library">Add reference to library <a class="permalink" href="#add-reference-to-library" aria-hidden="true">#</a></h3>
<p>Within a SharePoint page add a script editor web part and then paste in the following code. The div is to give you a place to target with visual updates should you desire.</p>
<pre><code class="language-HTML"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://localhost:8080/assets/pnp.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pnptestdiv"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>You should see an alert with the current web’s title using the default main.ts. Feel free to update main.ts to do whatever you would like, but note that any changes
included as part of a PR to this file will not be allowed.</p>
<h3 id="serve-a-specific-package">Serve a specific package <a class="permalink" href="#serve-a-specific-package" aria-hidden="true">#</a></h3>
<p>For example if you wanted to serve the @pnp/sp package for testing you would use:</p>
<p><code>gulp serve --p sp</code></p>
<p>This will serve a bundle of the sp functionality along with all dependencies and place a global variable named “pnp.{packagename}”, in this case pnp.sp. This will be
true for each package, if you served just the graph package the global would be pnp.graph. This mirrors how the umd modules are built in the distributed npm packages
to allow testing with matching packages.</p>
<h3 id="next-steps-2">Next Steps <a class="permalink" href="#next-steps-2" aria-hidden="true">#</a></h3>
<p>You can make changes to the library and immediately see them reflected in the browser. All files are watched regardless of which serve method you choose.</p>
<h2 id="register-an-add-in">Register an Add-in <a class="permalink" href="#register-an-add-in" aria-hidden="true">#</a></h2>
<p>Before you can begin debugging you need to register a low-trust add-in with SharePoint. This is primarily designed for Office 365, but can work on-premises if you <a href="https://msdn.microsoft.com/en-us/library/office/dn155905.aspx">configure you farm accordingly</a>.</p>
<ol>
<li>Navigation to {site url}/_layouts/appregnew.aspx</li>
<li>Click “Generate” for both the Client Id and Secret values</li>
<li>Give you add-in a title, this can be anything but will let you locate it in the list of add-in permissions</li>
<li>Provide a fake value for app domain and redirect uri, you can use the values shown in the examples</li>
<li>Click “Create”</li>
<li>Copy the returned block of text containing the client id and secret as well as app name for your records and later in this article.</li>
</ol>
<h3 id="grant-your-add-in-permissions">Grant Your Add-In Permissions <a class="permalink" href="#grant-your-add-in-permissions" aria-hidden="true">#</a></h3>
<p>Now that we have created an add-in registration we need to tell SharePoint what permissions it can use. Due to an update in SharePoint Online you now have to <a href="https://msdn.microsoft.com/en-us/pnp_articles/how-to-provide-add-in-app-only-tenant-administrative-permissions-in-sharepoint-online">register add-ins with certain permissions in the admin site</a>.</p>
<ol>
<li>Navigate to {admin site url}/_layouts/appinv.aspx</li>
<li>Paste your client id from the above section into the Add Id box and click “Lookup”</li>
<li>You should see the information populated into the form from the last section, if not ensure you have the correct id value</li>
<li>Paste the below XML into the permissions request xml box and hit “Create”</li>
<li>You should get a confirmation message.</li>
</ol>
<pre><code class="language-XML">  <span class="hljs-tag">&lt;<span class="hljs-name">AppPermissionRequests</span> <span class="hljs-attr">AllowAppOnlyPolicy</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AppPermissionRequest</span> <span class="hljs-attr">Scope</span>=<span class="hljs-string">"http://sharepoint/content/sitecollection"</span> <span class="hljs-attr">Right</span>=<span class="hljs-string">"FullControl"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AppPermissionRequest</span> <span class="hljs-attr">Scope</span>=<span class="hljs-string">"http://sharepoint/social/tenant"</span> <span class="hljs-attr">Right</span>=<span class="hljs-string">"FullControl"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AppPermissionRequest</span> <span class="hljs-attr">Scope</span>=<span class="hljs-string">"http://sharepoint/search"</span> <span class="hljs-attr">Right</span>=<span class="hljs-string">"QueryAsUserIgnoreAppPrincipal"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">AppPermissionRequests</span>&gt;</span>
</code></pre>
<p><strong><em>Note these are very broad permissions to ensure you can test any feature of the library, for production you should tailor the permissions to only those required</em></strong></p>
<h3 id="configure-the-project-settings-file">Configure the project settings file <a class="permalink" href="#configure-the-project-settings-file" aria-hidden="true">#</a></h3>
<ol>
<li>If you have not already, make a copy of settings.example.js and name it settings.js</li>
<li>Edit this file to set the values on the testing.sp object to
<ul>
<li>id: “The client id you created”</li>
<li>secret: “The client secret you created”</li>
<li>url: “{site url}”</li>
</ul>
</li>
<li>You can disable web tests at any time by setting enableWebTests to false in settings.js, this can be helpful as they take a few minutes to run</li>
</ol>

    </article>

    <footer>
        <div class="brand">© Microsoft 2018</div>
        <div class="call-to-action">Please
            <a href="https://github.com/pnp/pnpjs/issues/new?title=Documentation: debugging.html&body=Please describe how we can improve the doc page:">report documentation issues/suggestions</a> to help us improve!</div>
    </footer>
</body>

</html><img src="https://telemetry.sharepointpnp.com/@pnp/pnpjs/ghpages/debugging" alt="spacer" />