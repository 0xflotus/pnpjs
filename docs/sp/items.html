<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>@pnp - SharePoint Patterns and Practices JavaScript Libraries</title>
    <link rel="stylesheet" href="/pnpjs/css/highlightjs-github.css">
    <link rel="stylesheet" href="/pnpjs/css/site.css">
</head>

<body>
    <header>
        <span id="headerText">
            <a href="/pnpjs">SharePoint Patterns and Practices</a>
        </span>
        <span id="subheaderText">Client Side Libraries</span>
    </header>

    <nav id="breadcrumbs">
        <a href="/pnpjs">@pnp</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/pnpjs/sp">sp</a>&nbsp;&nbsp;&gt;&nbsp;&nbsp;<a href="/pnpjs/sp/items.html">items</a>
    </nav>

    <article>
        <h1>@pnp/sp/items</h1>
<h2>GET</h2>
<p>Getting items from a list is one of the basic actions that most applications require. This is made easy through the library and the following examples demonstrate these actions.</p>
<h3>Basic Get</h3>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-comment">// get all the items from a list</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"My List"</span>).items.get().then(<span class="hljs-function">(<span class="hljs-params">items: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(items);
});

<span class="hljs-comment">// get a specific item by id</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"My List"</span>).items.getById(<span class="hljs-number">1</span>).get().then(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(item);
});

<span class="hljs-comment">// use odata operators for more efficient queries</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"My List"</span>).items.select(<span class="hljs-string">"Title"</span>, <span class="hljs-string">"Description"</span>).top(<span class="hljs-number">5</span>).orderBy(<span class="hljs-string">"Modified"</span>, <span class="hljs-literal">true</span>).get().then(<span class="hljs-function">(<span class="hljs-params">items: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(items);
});
</code></pre>
<h3>Get All Items</h3>
<p><em>Added in 1.0.2</em></p>
<p>Using the items collection’s getAll method you can get all of the items in a list regardless of the size of the list. Sample usage is shown below. Only the odata operations top, select, and filter are supported. usingCaching and inBatch are ignored - you will need to handle caching the results on your own. This method will write a warning to the Logger and should not frequently be used. Instead the standard paging operations should
be used.</p>
<pre><code class="language-TypeScript"><span class="hljs-comment">// basic usage</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"BigList"</span>).items.getAll().then(<span class="hljs-function">(<span class="hljs-params">allItems: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {

    <span class="hljs-comment">// how many did we get</span>
    <span class="hljs-built_in">console</span>.log(allItems.length);
});

<span class="hljs-comment">// set page size</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"BigList"</span>).items.getAll(<span class="hljs-number">4000</span>).then(<span class="hljs-function">(<span class="hljs-params">allItems: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {

    <span class="hljs-comment">// how many did we get</span>
    <span class="hljs-built_in">console</span>.log(allItems.length);
});

<span class="hljs-comment">// use select and top. top will set page size and override the any value passed to getAll</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"BigList"</span>).items.select(<span class="hljs-string">"Title"</span>).top(<span class="hljs-number">4000</span>).getAll().then(<span class="hljs-function">(<span class="hljs-params">allItems: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {

    <span class="hljs-comment">// how many did we get</span>
    <span class="hljs-built_in">console</span>.log(allItems.length);
});

<span class="hljs-comment">// we can also use filter as a supported odata operation, but this will likely fail on large lists</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"BigList"</span>).items.select(<span class="hljs-string">"Title"</span>).filter(<span class="hljs-string">"Title eq 'Test'"</span>).getAll().then(<span class="hljs-function">(<span class="hljs-params">allItems: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {

    <span class="hljs-comment">// how many did we get</span>
    <span class="hljs-built_in">console</span>.log(allItems.length);
});
</code></pre>
<h3>Retrieving Lookup Fields</h3>
<p>When working with lookup fields you need to use the expand operator along with select to get the related fields from the lookup column. This works for both the items collection and item instances.</p>
<pre><code class="language-TypeScript">pnp.sp.web.lists.getByTitle(<span class="hljs-string">"LookupList"</span>).items.select(<span class="hljs-string">"Title"</span>, <span class="hljs-string">"Lookup/Title"</span>, <span class="hljs-string">"Lookup/ID"</span>).expand(<span class="hljs-string">"Lookup"</span>).get().then(<span class="hljs-function">(<span class="hljs-params">items: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(items);
});

pnp.sp.web.lists.getByTitle(<span class="hljs-string">"LookupList"</span>).items.getById(<span class="hljs-number">1</span>).select(<span class="hljs-string">"Title"</span>, <span class="hljs-string">"Lookup/Title"</span>, <span class="hljs-string">"Lookup/ID"</span>).expand(<span class="hljs-string">"Lookup"</span>).get().then(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(item);
});
</code></pre>
<h3>Retrieving PublishingPageImage</h3>
<p>The PublishingPageImage and some other publishing-related fields aren’t stored in normal fields, rather in the MetaInfo field. To get these values you need to use the technique shown below, and originally outlined in <a href="https://github.com/SharePoint/PnP-JS-Core/issues/178">this thread</a>. Note that a lot of information can be stored in this field so will pull back potentially a significant amount of data, so limit the rows as possible to aid performance.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { Web } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">const</span> w = <span class="hljs-keyword">new</span> Web(<span class="hljs-string">"https://{publishing site url}"</span>);

w.lists.getByTitle(<span class="hljs-string">"Pages"</span>).items
    .select(<span class="hljs-string">"Title"</span>, <span class="hljs-string">"FileRef"</span>, <span class="hljs-string">"FieldValuesAsText/MetaInfo"</span>)
    .expand(<span class="hljs-string">"FieldValuesAsText"</span>)
    .get().then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {

        <span class="hljs-comment">// look through the returned items.</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; r.length; i++) {

            <span class="hljs-comment">// the title field value</span>
            <span class="hljs-built_in">console</span>.log(r[i].Title);

            <span class="hljs-comment">// find the value in the MetaInfo string using regex</span>
            <span class="hljs-keyword">const</span> matches = <span class="hljs-regexp">/PublishingPageImage:SW\|(.*?)\r\n/ig</span>.exec(r[i].FieldValuesAsText.MetaInfo);
            <span class="hljs-keyword">if</span> (matches !== <span class="hljs-literal">null</span> &amp;&amp; matches.length &gt; <span class="hljs-number">1</span>) {

                <span class="hljs-comment">// this wil be the value of the PublishingPageImage field</span>
                <span class="hljs-built_in">console</span>.log(matches[<span class="hljs-number">1</span>]);
            }
        }
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> { <span class="hljs-built_in">console</span>.error(e); });
</code></pre>
<h2>Add Items</h2>
<p>There are several ways to add items to a list. The simplest just uses the <em>add</em> method of the items collection passing in the properties as a plain object.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> pnp, ItemAddResult } <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-comment">// add an item to the list</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"My List"</span>).items.add({
    Title: <span class="hljs-string">"Title"</span>,
    Description: <span class="hljs-string">"Description"</span>
}).then(<span class="hljs-function">(<span class="hljs-params">iar: ItemAddResult</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(iar);
});
</code></pre>
<h3>Content Type</h3>
<p>You can also set the content type id when you create an item as shown in the example below:</p>
<pre><code class="language-TypeScript">pnp.sp.web.lists.getById(<span class="hljs-string">"4D5A36EA-6E84-4160-8458-65C436DB765C"</span>).items.add({
    Title: <span class="hljs-string">"Test 1"</span>,
    ContentTypeId: <span class="hljs-string">"0x01030058FD86C279252341AB303852303E4DAF"</span>
});
</code></pre>
<h3>User Fields</h3>
<p>There are two types of user fields, those that allow a single value and those that allow multiple. For both types, you first need to determine the Id field name, which you can do by doing a GET REST request on an existing item. Typically the value will be the user field internal name with “Id” appended. So in our example, we have two fields User1 and User2 so the Id fields are User1Id and User2Id.</p>
<p>Next, you need to remember there are two types of user fields, those that take a single value and those that allow multiple - these are updated in different ways. For single value user fields you supply just the user’s id. For multiple value fields, you need to supply an object with a “results” property and an array. Examples for both are shown below.</p>
<pre><code class="language-TypeScript">pnp.sp.web.lists.getByTitle(<span class="hljs-string">"PeopleFields"</span>).items.add({
    Title: Util.getGUID(),
    User1Id: <span class="hljs-number">9</span>, <span class="hljs-comment">// allows a single user</span>
    User2Id: { 
        results: [ <span class="hljs-number">16</span>, <span class="hljs-number">45</span> ] <span class="hljs-comment">// allows multiple users</span>
    }
}).then(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(i);
});
</code></pre>
<h3>Lookup Fields</h3>
<p>What is said for User Fields is, in general, relevant to Lookup Fields:</p>
<ul>
<li>Lookup Field types:
<ul>
<li>Single-valued lookup</li>
<li>Multiple-valued lookup</li>
</ul>
</li>
<li><code>Id</code> suffix should be appended to the end of lookup’s <code>EntityPropertyName</code> in payloads</li>
<li>Numeric Ids for lookups’ items should be passed as values</li>
</ul>
<pre><code class="language-TypeScript">pnp.sp.web.lists.getByTitle(<span class="hljs-string">"LookupFields"</span>).items.add({
    Title: Util.getGUID(),
    LookupFieldId: <span class="hljs-number">2</span>,       <span class="hljs-comment">// allows a single lookup value</span>
    MuptiLookupFieldId: { 
        results: [ <span class="hljs-number">1</span>, <span class="hljs-number">56</span> ]  <span class="hljs-comment">// allows multiple lookup value</span>
    }
}).then(<span class="hljs-built_in">console</span>.log).catch(<span class="hljs-built_in">console</span>.log);
</code></pre>
<h3>Add Multiple Items</h3>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">let</span> list = pnp.sp.web.lists.getByTitle(<span class="hljs-string">"rapidadd"</span>);

list.getListItemEntityTypeFullName().then(<span class="hljs-function"><span class="hljs-params">entityTypeFullName</span> =&gt;</span> {

    <span class="hljs-keyword">let</span> batch = pnp.sp.web.createBatch();

    list.items.inBatch(batch).add({ Title: <span class="hljs-string">"Batch 6"</span> }, entityTypeFullName).then(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(b);
    });

    list.items.inBatch(batch).add({ Title: <span class="hljs-string">"Batch 7"</span> }, entityTypeFullName).then(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(b);
    });

    batch.execute().then(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Done"</span>));
});
</code></pre>
<h2>Update</h2>
<p>The update method is very similar to the add method in that it takes a plain object representing the fields to update. The property names are the internal names of the fields. If you aren’t sure you can always do a get request for an item in the list and see the field names that come back - you would use these same names to update the item.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">let</span> list = pnp.sp.web.lists.getByTitle(<span class="hljs-string">"MyList"</span>);

list.items.getById(<span class="hljs-number">1</span>).update({
    Title: <span class="hljs-string">"My New Title"</span>,
    Description: <span class="hljs-string">"Here is a new description"</span>
}).then(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(i);
});
</code></pre>
<h3>Getting and updating a collection using filter</h3>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-comment">// you are getting back a collection here</span>
pnp.sp.web.lists.getByTitle(<span class="hljs-string">"MyList"</span>).items.top(<span class="hljs-number">1</span>).filter(<span class="hljs-string">"Title eq 'A Title'"</span>).get().then(<span class="hljs-function">(<span class="hljs-params">items: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> {
    <span class="hljs-comment">// see if we got something</span>
    <span class="hljs-keyword">if</span> (items.length &gt; <span class="hljs-number">0</span>) {
        pnp.sp.web.lists.getByTitle(<span class="hljs-string">"MyList"</span>).items.getById(items[<span class="hljs-number">0</span>].Id).update({
            Title: <span class="hljs-string">"Updated Title"</span>,
        }).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
            <span class="hljs-comment">// here you will have updated the item</span>
            <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(result));
        });
    }
});
</code></pre>
<h3>Update Multiple Items</h3>
<p>This approach avoids multiple calls for the same list’s entity type name.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">let</span> list = pnp.sp.web.lists.getByTitle(<span class="hljs-string">"rapidupdate"</span>);

list.getListItemEntityTypeFullName().then(<span class="hljs-function"><span class="hljs-params">entityTypeFullName</span> =&gt;</span> {

    <span class="hljs-keyword">let</span> batch = pnp.sp.web.createBatch();

    <span class="hljs-comment">// note requirement of "*" eTag param - or use a specific eTag value as needed</span>
    list.items.getById(<span class="hljs-number">1</span>).inBatch(batch).update({ Title: <span class="hljs-string">"Batch 6"</span> }, <span class="hljs-string">"*"</span>, entityTypeFullName).then(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(b);
    });

    list.items.getById(<span class="hljs-number">2</span>).inBatch(batch).update({ Title: <span class="hljs-string">"Batch 7"</span> }, <span class="hljs-string">"*"</span>, entityTypeFullName).then(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(b);
    });

    batch.execute().then(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Done"</span>));
});
</code></pre>
<h2>Delete</h2>
<p>Delete is as simple as calling the .delete method. It optionally takes an eTag if you need to manage concurrency.</p>
<pre><code class="language-TypeScript"><span class="hljs-keyword">import</span> pnp <span class="hljs-keyword">from</span> <span class="hljs-string">"@pnp/sp"</span>;

<span class="hljs-keyword">let</span> list = pnp.sp.web.lists.getByTitle(<span class="hljs-string">"MyList"</span>);

list.items.getById(<span class="hljs-number">1</span>).delete().then(_ =&gt; {});
</code></pre>
<h2>Resolving field names</h2>
<p>It’s a very common mistake trying wrong field names in the requests.
Field’s <code>EntityPropertyName</code> value should be used.</p>
<p>The easiest way to get know EntityPropertyName is to use the following snippet:</p>
<pre><code class="language-TypeScript">pnp.sp.web.lists
  .getByTitle(<span class="hljs-string">'[Lists_Title]'</span>)
  .fields
  .select(<span class="hljs-string">'Title, EntityPropertyName'</span>)
  .filter(<span class="hljs-string">`Hidden eq false and Title eq '[Field's_Display_Name]'`</span>)
  .get()
  .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(response.map(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        Title: field.Title,
	EntityPropertyName: field.EntityPropertyName
      };
    }));
  })
  .catch(<span class="hljs-built_in">console</span>.log);
</code></pre>
<p>Lookup fields’ names should be ended with additional <code>Id</code> suffix. E.g. for <code>Editor</code> EntityPropertyName <code>EditorId</code> should be used.</p>

    </article>

    <footer>
        &copy; Microsoft 2018
        <br /> Please
        <a href="https://github.com/pnp/pnpjs/issues/new?title=Documentation: sp\items.html&body=Please describe how we can improve the doc page:">report documentation issues/suggestions</a> to help us improve!
    </footer>
</body>

</html><img src="https://telemetry.sharepointpnp.com/@pnp/pnpjs/ghpages/sp/docs/items" alt="spacer" />